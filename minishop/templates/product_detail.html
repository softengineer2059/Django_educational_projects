<!DOCTYPE html>
{% extends 'base.html' %}
{% load static %}
{% load custom_tags %}

{% block styles %}
	<link href="{% static ''%}assets/plugins/lightgallery/gallery.css" rel="stylesheet">
	<link href="{% static 'assets/css/image_window.css'%}" rel="stylesheet" />
{% endblock styles %}

					{% block body %}
						<!--Page header-->
						<div class="page-header">
							<div class="page-rightheader ms-auto d-lg-flex d-none">
								<ol class="breadcrumb">
									<li class="breadcrumb-item"><a href="{% url 'main' %}" class="d-flex"><svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3zm5 15h-2v-6H9v6H7v-7.81l5-4.5 5 4.5V18z"/><path d="M7 10.19V18h2v-6h6v6h2v-7.81l-5-4.5z" opacity=".3"/></svg><span class="breadcrumb-icon"> Главная</span></a></li>
									<li class="breadcrumb-item"><a href="{% url 'main' %}?category={{ product.category.id }}">{{product.category}}</a></li>
									<li class="breadcrumb-item"><a href="{% url 'main' %}?category={{ product.category.id }}&subcategory={{ product.sub_category.id }}">{{product.sub_category}}</a></li>
								</ol>
							</div>
						</div>

						<div class="row">
							<div class="col-md-12 wrapper wrapper-content">
								<div class="ibox card">
									 <div class="card-header">
										<h3 class="card-title">Описание</h3>
									</div>
									<div class="card-body">
										<div class="ibox-content">
											<div class="demo-gallery card">
												<div class="card-header">
													<div class="card-title">Галерея</div>
												</div>
												<div class="card-body">
													<ul id="lightgallery" class="list-unstyled row">
														{% for i in images %}
															<li class="col-xs-6 col-sm-4 col-md-3" data-responsive="http://127.0.0.1:8000/media/{{i}}" data-src="http://127.0.0.1:8000/media/{{i}}" data-sub-html="<h4>Gallery Image 1</h4><p> Many desktop publishing packages and web page editors now use Lorem Ipsum</p>" >
																<a href="javascript:void(0)">
																	<img class="img-responsive" src="http://127.0.0.1:8000/media/{{i}}" alt="Thumb-1">
																</a>
															</li>
														{% endfor %}
													</ul>
												</div>
											</div>
											<div class="row">
												<div class="col-md-12 col-lg-12">
													<div class="pb-5">
														<h3>
															<a href="javascript:void(0)" class="text-navy">{{ product.product_name }}</a>
														</h3>
														<div class="mb-3" id="star-rating">
															<a href="javascript:void(0)"><i class="fa fa-star text-warning"></i></a>
															<a href="javascript:void(0)"><i class="fa fa-star text-warning"></i></a>
															<a href="javascript:void(0)"><i class="fa fa-star text-warning"></i></a>
															<a href="javascript:void(0)"><i class="fa fa-star text-warning"></i></a>
															<a href="javascript:void(0)"><i class="fa fa-star-o text-warning"></i></a>
															<span class="fs-16 ms-3"><span id="product_grade">{{ product_grade.total }}</span> <small>({{ product_grade.count }} отзывов)</small></span>
														</div>
														<div>
															<p>{{ product.product_details }}</p>
														</div>
														<h3 class="font-weight-bold">₽ {{ product.discounted_price }} <del class="h5 font-weight-normal">₽ {{ product.regular_price }}</del></h3>
													</div>
												</div>
											</div>
											<div class="ibox-content card-footer text-end">
												<button onclick="add_to_cart(this)" class="btn btn-primary btn-svgs mt-1 mb-1" data-product-id="{{ product.id }}"><svg  class="svg-icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M15.55 11l2.76-5H6.16l2.37 5z" opacity=".3"/><path d="M15.55 13c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.37-.66-.11-1.48-.87-1.48H5.21l-.94-2H1v2h2l3.6 7.59-1.35 2.44C4.52 15.37 5.48 17 7 17h12v-2H7l1.1-2h7.45zM6.16 6h12.15l-2.76 5H8.53L6.16 6zM7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg> Добавить в корзину</button>
											</div>
										</div>

										<div class="card box-widget widget-user">
											<a href="{% url 'vendor_shop' product.vendor.id %}">
												<div class="widget-user-image mx-auto mt-5 text-center"><img style="width: 500px; height: 250px;" alt="User Avatar" class="rounded-circle" src="{{ MEDIA_URL }}{{ product.vendor.logo }}"></div>
												<div class="card-body text-center">
													<div class="pro-user">
														<h3 class="pro-user-username text-dark mb-1">{{ product.vendor.company_name }}</h3>
														<h6 class="pro-user-desc text-muted">Продавец</h6>
													</div>
												</div>
											</a>
										</div>

										<!-- Рекомендации "с этим товаром покупают" -->
										{% if related_recommendations %}
											<div class="recommendations-section">
												<h3>Сиотрите также</h3>
												<div class="row">
													{% for product in related_recommendations %}
													<div class="col-md-3">
														<div class="product-card">
															<a href="{{ product.get_absolute_url }}">
																{% with product.images.all|first as first_image %}
    																{% if first_image %}
																		<img class="img-responsive" src="http://127.0.0.1:8000/media/{{ first_image.image }}" alt="Thumb-1">
																	{% endif %}
																{% endwith %}
																<h5>{{ product.product_name }}</h5>
																<p class="price">{{ product.discounted_price|default:product.regular_price }} руб.</p>
															</a>
														</div>
													</div>
													{% endfor %}
												</div>
											</div>
										{% endif %}

									</div>
								</div>

								{% if user_has_comment != 'True' %}
									<div class="card mb-lg-0">
										{% if messages %}
											<ul class="messages">
												{% for message in messages %}
													<li>{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
												{% endfor %}
											</ul>
										{% endif %}
										<div class="card-header">
											<h3 class="card-title">Отзыв</h3>
										</div>
										<form action="{% url 'add_comment' product.id %}" method="post" enctype="multipart/form-data">{% csrf_token %}
											<div class="card-body">
												<div class="mt-2">
													<div class="mb-3">
														<div class="rating-stars block" id="rating">
															<h3 class="card-title">Оцените товар:</h3>
															<div class="rating-stars-container" style="transform: scale(4);">
																<div class="rating-star sm"><i class="fa fa-star"></i></div>
																<div class="rating-star sm"><i class="fa fa-star"></i></div>
																<div class="rating-star sm"><i class="fa fa-star"></i></div>
																<div class="rating-star sm"><i class="fa fa-star"></i></div>
																<div class="rating-star sm"><i class="fa fa-star"></i></div>
															</div>
														</div>
													</div>
													<br>
													<br>
													<input type="hidden" name="grade" value="0"> <!-- Скрытое поле для рейтинга -->

													<div class="mb-3">
														<textarea class="form-control" name="text" rows="6" placeholder="Write Review"></textarea>
													</div>

													<div class="input-group mb-5">
														<label class="input-group-btn">
															<span class="btn btn-primary">
																Выберите фото <input name="image" type="file" style="display: none;" multiple="" id="file-input">
															</span>
														</label>
													</div>
													<div id="file-list" class="mt-3"></div>
													<button class="btn btn-primary" type="submit">Отправить</button>
												</div>
											</div>
										</form>
									</div>
								{% else %}
									<div class="card mb-lg-0">
										<div class="card-header">
											<h3 class="card-title">Спасибо за ваш отзыв!</h3>
										</div>
									</div>
								{% endif %}
								{% if product_has_comments == 'True' %}
									<div class="card">
										<div class="card-header">
											<h3 class="card-title">Отзывов: {{ product_comments.count }}</h3>
										</div>
										<div class="card-body">
											{% for comment in product_comments %}
												<div class="d-sm-flex p-5 mt-4 border sub-review-section">
													<div class="d-flex me-3">
														{% if avatars_dict|get_item:comment.user.id %}
															<img class="media-object brround avatar-md" alt="64x64" src="{{ avatars_dict|get_item:comment.user.id }}">
														{% else %}
															<img class="media-object brround avatar-md" alt="64x64" src='{% static "assets/images/non-avatar.jpg" %}'>
														{% endif %}
													</div>
													<div class="media-body">
														<h5 class="mt-0 mb-1 font-weight-semibold">{{ comment.user.username }}
															<span class="fs-14 ms-0" data-bs-toggle="tooltip" data-bs-placement="top" title="" data-bs-original-title="verified"><i class="fa fa-check-circle-o text-success"></i></span>
															<span class="fs-14 ms-2"> {{ comment.grade }} <i class="fa fa-star text-yellow"></i></span>
															<small class="text-muted">{{ comment.created_at }}</small>
														</h5>

														<div class="card-body_comments">
															<ul class="list-unstyled row">
																{% for img in comments_images %}
																	{% if img.comment == comment %}
																		<li class="col-xs-6 col-sm-4 col-md-3" data-responsive="http://127.0.0.1:8000/media/{{i}}" data-src="http://127.0.0.1:8000/media/{{i}}" data-sub-html="<h4>Gallery Image 1</h4><p> Many desktop publishing packages and web page editors now use Lorem Ipsum</p>" >
																			<a href="javascript:void(0)">
																				<img class="img-responsive" src="http://127.0.0.1:8000/media/{{img.image}}" alt="Описание изображения">
																			</a>
																		</li>
																	{% endif %}
																{% endfor %}
															</ul>
														</div>
														<p class="font-13  mb-2 mt-2">
															<h3>{{ comment.text }}</h3>
														</p>
														<div class="btn-group btn-group-sm mb-1 ms-auto float-sm-end mt-1">
															<button hx-get="{% url 'comment_like_dislike' comment.id 'like' %}" class="btn btn-light" type="button"><svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 0 24 24" width="18"><path d="M0 0h24v24H0V0zm0 0h24v24H0V0z" fill="none"></path><path d="M21 12v-2h-9l1.34-5.34L9 9v10h9z" opacity=".3"></path><path d="M9 21h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.58 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2zM9 9l4.34-4.34L12 10h9v2l-3 7H9V9zM1 9h4v12H1z"></path></svg><span class="fs-16 ms-3">{{ likes_dict|get_likes:comment.id }}</span></button>
															<button hx-get="{% url 'comment_like_dislike' comment.id 'dislike' %}" class="btn btn-light" type="button"><svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 0 24 24" width="18"><path d="M0 0h24v24H0V0z" fill="none" opacity=".87"></path><path d="M3 12v2h8.77l-1.11 5.34L15 15V5H6z" opacity=".3"></path><path d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.58-6.59c.37-.36.59-.86.59-1.41V5c0-1.1-.9-2-2-2zm0 12l-4.34 4.34L11.77 14H3v-2l3-7h9v10zm4-12h4v12h-4z"></path></svg><span class="fs-16 ms-3">{{ likes_dict|get_dislikes:comment.id }}</span></button>
														</div>
														{% if comment.user == user or user.is_staff %}
															<div>
																<a href="{% url 'edit_comment' comment.id %}" class="btn btn-light btn-svgs mt-1 mb-1" style="justify-content: center;"><i class="fa fa-cog" data-bs-toggle="tooltip" title="" data-bs-original-title="fa fa-cog" aria-label="fa fa-cog"></i> Изменить</a>
																<button onclick="send_url_to_modal_comment({{ comment.id }})" type="button" class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#smallmodal"><svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 9h8v10H8z" opacity=".3"/><path d="M15.5 4l-1-1h-5l-1 1H5v2h14V4zM6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9z"/></svg>Удалить комментарий</button>
															</div>
														{% endif %}
													</div>
												</div>
											{% endfor %}
										</div>
									</div>
								{% else %}
									<div class="card">
										<div class="card-header">
											<h3 class="card-title">Нет отзывов</h3>
										</div>
									</div>
								{% endif %}
							</div>
						</div>

					{% endblock body %}

					{% block modal %}
                        <div class="modal  fade" id="smallmodal" tabindex="-1" role="dialog" aria-labelledby="smallmodal" aria-hidden="true">
                            <div class="modal-dialog modal-sm" role="document">
                                <form id="remove-link" method="post" action="#">
                                    {% csrf_token %}
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="smallmodal1">Удаление товара</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">×</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <p>Удалить товар из базы?</p>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Нет</button>
                                            <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">да</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

						<div id="imageModal" class="image_modal" style="display:none;">
							<span class="close" onclick="closeModal()">&times;</span>
							<img class="modal-content" id="modalImage">
							<div id="caption"></div>
						</div>
            		{% endblock modal %}


		{% include 'scripts.html' %}
		{% block scripts %}
			<script src="{% static ''%}assets/plugins/lightgallery/picturefill.js"></script>
			<script src="{% static ''%}assets/plugins/lightgallery/lightgallery.js"></script>
        	<script src="{% static ''%}assets/plugins/lightgallery/lg-pager.js"></script>
        	<script src="{% static ''%}assets/plugins/lightgallery/lg-autoplay.js"></script>
        	<script src="{% static ''%}assets/plugins/lightgallery/lg-fullscreen.js"></script>
        	<script src="{% static ''%}assets/plugins/lightgallery/lg-zoom.js"></script>
       	 	<script src="{% static ''%}assets/plugins/lightgallery/lg-hash.js"></script>
        	<script src="{% static ''%}assets/plugins/lightgallery/lg-share.js"></script>
        	<script src="{% static ''%}assets/js/gallery.js"></script>
			<script src="{% static ''%}assets/js/image_window.js"></script>
			<script src="{% static ''%}assets/js/star_rating_for_product.js"></script>
		{% endblock scripts %}








