{% extends 'base.html' %}
{% load static%}

		{% block styles %}
		<!-- Select2 css -->
		<link href="{% static ''%}assets/plugins/select2/select2.min.css" rel="stylesheet" />

		<!-- Time picker css -->
		<link href="{% static ''%}assets/plugins/time-picker/jquery.timepicker.css" rel="stylesheet" />

		<!-- Date Picker css -->
		<link href="{% static ''%}assets/plugins/date-picker/date-picker.css" rel="stylesheet" />

		<!-- File Uploads css-->
        <link href="{% static ''%}assets/plugins/fileupload/css/fileupload.css" rel="stylesheet" type="text/css" />
		{% endblock styles %}

						{% block body %}
						<!--Page header-->
						<div class="page-header">
							<div class="page-leftheader">
								<h4 class="page-title">Form-Elements</h4>
							</div>
							<div class="page-rightheader ms-auto d-lg-flex d-none">
								<ol class="breadcrumb">
									<li class="breadcrumb-item"><a href="javascript:void(0)" class="d-flex"><svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3zm5 15h-2v-6H9v6H7v-7.81l5-4.5 5 4.5V18z"/><path d="M7 10.19V18h2v-6h6v6h2v-7.81l-5-4.5z" opacity=".3"/></svg><span class="breadcrumb-icon"> Home</span></a></li>
									<li class="breadcrumb-item"><a href="javascript:void(0)">Pages</a></li>
									<li class="breadcrumb-item"><a href="javascript:void(0)">Elements</a></li>
									<li class="breadcrumb-item active" aria-current="page">Form-Elements</li>
								</ol>
							</div>
						</div>
						<!--End Page header-->

						<div class="container mt-4">
							<h2>Регистрация продавца</h2>

							<div class="progress mb-4">
								<div class="progress-bar" role="progressbar" style="width: 100%">Заполните все данные</div>
							</div>

							<form method="post" enctype="multipart/form-data" id="vendorForm">
								{% csrf_token %}

								<div class="card">
									<div class="card-header">
										<h3 class="card-title">Основная информация </h3>
									</div>
									<div class="card-body pb-2">
										<div class="row row-sm">
											<div class="col-lg">
												{{ vendor_form.company_name }}
												{% if vendor_form.company_name.errors %}
													<div class="text-danger">
														{% for error in vendor_form.company_name.errors %}
															<small>{{ error }}</small>
														{% endfor %}
													</div>
												{% endif %}
											</div>
										</div>
										<div class="row row-sm">
											<div class="col-lg">
												{{ vendor_form.phone_number }}
												{% if vendor_form.phone_number.errors %}
													<div class="text-danger">
														{% for error in vendor_form.phone_number.errors %}
															<small>{{ error }}</small>
														{% endfor %}
													</div>
												{% endif %}
											</div>
										</div>
										<div class="row row-sm">
											<div class="col-lg">
												{{ vendor_form.email }}
												{% if vendor_form.email.errors %}
													<div class="text-danger">
														{% for error in vendor_form.email.errors %}
															<small>{{ error }}</small>
														{% endfor %}
													</div>
												{% endif %}
											</div>
										</div>
										<div class="row row-sm">
											<div class="col-lg">
												{{ vendor_form.address }}
												{% if vendor_form.address.errors %}
													<div class="text-danger">
														{% for error in vendor_form.address.errors %}
															<small>{{ error }}</small>
														{% endfor %}
													</div>
												{% endif %}
											</div>
										</div>
										<div class="row row-sm">
											<div class="col-lg">
												{{ vendor_form.description }}
												{% if vendor_form.description.errors %}
													<div class="text-danger">
														{% for error in vendor_form.description.errors %}
															<small>{{ error }}</small>
														{% endfor %}
													</div>
												{% endif %}
											</div>
										</div>
										<div class="row row-sm">
											<div class="col-lg">
												<div class="card-header">
													<h5 class="card-title">{{ vendor_form.logo.label }} </h5>
												</div>
												{{ vendor_form.logo }}
												{% if vendor_form.logo.errors %}
													<div class="text-danger">
														{% for error in vendor_form.logo.errors %}
															<small>{{ error }}</small>
														{% endfor %}
													</div>
												{% endif %}
											</div>
										</div>
									</div>
								</div>

								<!-- Склады -->
								<div class="card mb-4">
									<div class="card-header d-flex justify-content-between align-items-center">
										<h5>Информация о складах</h5>
										<button type="button" class="btn btn-sm btn-outline-primary" id="addWarehouse">+ Добавить склад</button>
									</div>
									<div class="card-body" id="warehouse-forms">
										{{ warehouse_formset.management_form }}
										{% for form in warehouse_formset %}
										<div class="warehouse-form border p-3 mb-3">
											{% for field in form %}
											<div class="mb-2">
												<label class="form-label">{{ field.label }}</label>
												{{ field }}
											</div>
											{% endfor %}
											{% if not forloop.first %}
												<button type="button" class="btn btn-sm btn-danger remove-warehouse">Удалить</button>
											{% endif %}
										</div>
										{% endfor %}
									</div>
								</div>

								<button type="submit" class="btn btn-success btn-lg">Отправить заявку</button>
							</form>
						</div>

						{% endblock body %}
					
		{% block scripts %}
		<!--Select2 js -->
		<script src="{% static ''%}assets/plugins/select2/select2.full.min.js"></script>
		<script src="{% static ''%}assets/js/select2.js"></script>

		<!-- Timepicker js -->
		<script src="{% static ''%}assets/plugins/time-picker/jquery.timepicker.js"></script>
		<script src="{% static ''%}assets/plugins/time-picker/toggles.min.js"></script>

		<!-- Datepicker js -->
		<script src="{% static ''%}assets/plugins/date-picker/date-picker.js"></script>
		<script src="{% static ''%}assets/plugins/date-picker/jquery-ui.js"></script>
		<script src="{% static ''%}assets/plugins/input-mask/jquery.maskedinput.js"></script>

		<!-- File uploads js -->
        <script src="{% static ''%}assets/plugins/fileupload/js/dropify.js"></script>
		<script src="{% static ''%}assets/js/filupload.js"></script>

		<script>
			document.addEventListener('DOMContentLoaded', function() {
				// Динамическое добавление складов
				document.getElementById('addWarehouse').addEventListener('click', function() {
					const formCount = document.getElementById('id_warehouse-TOTAL_FORMS');
					const formsContainer = document.getElementById('warehouse-forms');
					const formNum = parseInt(formCount.value);

					const newForm = formsContainer.querySelector('.warehouse-form').cloneNode(true);
					newForm.innerHTML = newForm.innerHTML.replace(/warehouse-(\d+)-/g, `warehouse-${formNum}-`);

					// Очищаем значения
					newForm.querySelectorAll('input, textarea, select').forEach(field => {
						if (field.type !== 'checkbox' && field.type !== 'hidden') {
							field.value = '';
						}
						if (field.type === 'checkbox') {
							field.checked = false;
						}
					});

					// Добавляем кнопку удаления
					if (!newForm.querySelector('.remove-warehouse')) {
						const removeBtn = document.createElement('button');
						removeBtn.type = 'button';
						removeBtn.className = 'btn btn-sm btn-danger remove-warehouse';
						removeBtn.textContent = 'Удалить';
						newForm.appendChild(removeBtn);
					}

					formsContainer.appendChild(newForm);
					formCount.value = formNum + 1;
				});

				// Удаление складов
				document.addEventListener('click', function(e) {
					if (e.target.classList.contains('remove-warehouse')) {
						const formCount = document.getElementById('id_warehouse-TOTAL_FORMS');
						e.target.closest('.warehouse-form').remove();
						formCount.value = parseInt(formCount.value) - 1;
					}
				});
			});
    	</script>

		{% endblock scripts %}